<!DOCTYPE html>
<html xmlns="https://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
	<!-- link to MathJax for LaTeX stlye eqn -->
	 <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-MML-AM_CHTML">
</script>

	 
	 <!-- https://realfavicongenerator.net -->
	 <link rel="apple-touch-icon" sizes="180x180" href="/images/logos/favicon_package_v0.16_bw/apple-touch-icon.png">
	 <link rel="icon" type="image/png" sizes="32x32" href="/images/logos/favicon_package_v0.16_bw/favicon-32x32.png">
	 <link rel="icon" type="image/png" sizes="16x16" href="/images/logos/favicon_package_v0.16_bw/favicon-16x16.png">
	 <link rel="manifest" href="/images/logos/favicon_package_v0.16_bw/site.webmanifest">
	 <meta name="msapplication-TileColor" content="#da532c">
	 <meta name="theme-color" content="#ffffff">
	
	 <meta name="viewport" content="width=device-width, initial-scale=1">
	
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta name="description" content="A home for topics in human precision medicine, genomic analysis, and data visualisation.">
	<title>Correlation, regression and repeated data</title>
	<meta name="author" content="LawlessGenomics">
	<link href="https://lawlessgenomics.com/feed.xml" rel="alternate" title="LawlessGenomics" type="application/atom+xml">
	<!-- <meta name="readability-verification" content="QCzSs992GxmRYRKVpPeZ6LE2tS8aYKxsSSQKV8YM"/> -->
	
	<!-- include a google font -->
	<link href="https://fonts.googleapis.com/css?family=Roboto+Mono%7CRoboto+Slab:300%7CRoboto:500" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Lora" rel="stylesheet">
	
	<!-- syntax highlighting CSS -->
	<link rel="stylesheet" href="/css/syntax.css" type="text/css">
	
	<!-- Homepage CSS -->
	<link rel="stylesheet" href="/css/screen.css" type="text/css" media="screen, projection">
	
	<!-- Google font -->
	<link rel="preconnect" href="https://fonts.googleapis.com"> 
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> 
	<link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&amp;display=swap" rel="stylesheet">
	
	<!-- Typekit -->
	<script type="text/javascript" src="https://use.typekit.com/jpd0pfm.js"></script>
	<script type="text/javascript">try{Typekit.load();}catch(e){}</script>
</head>
<body>

<!-- ClickTale Top part -->
<script type="text/javascript">
	var WRInitTime=(new Date()).getTime();
</script>
<!-- ClickTale end of Top part -->

<!-- Logo and navigation bar -->



<!-- SITE START --------------------------------------------------------- -->
<div class="site">

<!-- NAV START --------------------------------------------------------- -->
<div class="sitewidthnav">
	<div class="title">
		<div class="nav-container">
			<nav>

			<div class="logoimage">
				<a href="/">
				<img style="margin-bottom:-16px" src="/images/logos/logo4.2_150ppi.png" alt="Logo image" width="25" height="38.5"></a>
				<!-- alt="Logo image" width="35.7" height="55" /></a> -->
			</div>

			<div class="logo">
				<a href="/">LawlessGenomics</a>
			</div>

				<input type="checkbox" id="nav-toggle">
					<label for="nav-toggle" class="gg-menu"></label>
					<div class="right-menu">
						<a href="/resume">About</a>
						<a href="/">Home</a>
					</div>
			</nav>
		</div>
	</div>



</div>
<!-- NAV END ----------------------------------------------------------- -->

<!-- MAIN START -------------------------------------------------------- -->
<div class="sitewidth">
	<div id="topic">
Reading time  8 minutes
<h1 id="correlation-regression-and-repeated-data">Correlation, regression and repeated data</h1>

<ul id="markdown-toc">
  <li><a href="#introduction" id="markdown-toc-introduction">Introduction</a></li>
  <li><a href="#correlation-within-subjects-part-1" id="markdown-toc-correlation-within-subjects-part-1">Correlation within subjects, part 1</a></li>
  <li><a href="#correlation-within-subjects-part-2" id="markdown-toc-correlation-within-subjects-part-2">Correlation within subjects, part 2</a></li>
  <li><a href="#references" id="markdown-toc-references">References</a></li>
</ul>

<h2 id="introduction">Introduction</h2>

<p>This topic is introduced as the first paper 
<a class="citation" href="#bland1994correlation">(Bland &amp; Altman, 1994)</a>
in a series of BMJ statistical notes by Altman &amp; Bland
(<a href="https://github.com/DylanLawless/notes/blob/main/202106291417-lit-altman_bland.md"> lit-altman_bland.md </a>):
1. Bland JM, Altman DG. (1994) <a href="http://www.bmj.com/cgi/content/full/308/6933/896"> Correlation, regression and repeated data.</a> <b>308</b>, 896.
<sup id="a1"><a href="#f1">1</a></sup></p>

<p>It concerns the analysis of paired data where there is more than one observation per subject.
They point out that it could be highly misleading to analyse such data by combining repeated observations from several subjects and then calculating the correlation coefficient as if the data were a simple sample.</p>

<p>Many researchers would assume that it is acceptable to gather repeated measurements for individuals and  put all the data together.</p>

<p>They use simulated data showing five pairs of measurements of two uncorrelated variables X and Y for subjects 1, 2, 3, 4, and 5.
Using each subject’s mean values, they show correlation coefficient r=-0.67, df=3, P=0.22.
However, when they put all 25 observations together they get r=-0.47, df=23, P=0.02.
When the calculation is performed as if they have 25 subjects, the number of degrees of freedom for the significance test is increased incorrectly and a spurious significant difference is produced.
Thus demonstrating that one should not mix observations from different subjects indiscriminately, whether using correlation or the closely related regression analysis.</p>

<h2 id="correlation-within-subjects-part-1">Correlation within subjects, part 1</h2>

<p>The methods to use in these circumstances are later discussed in another note for the BMJ series
<a class="citation" href="#bland1995statistics">(Bland &amp; Altman, 1995)</a>,
number 11 on the list <a href="https://github.com/DylanLawless/notes/blob/main/202106291417-lit-altman_bland.md"> lit-altman_bland.md </a>:
11. Bland JM, Altman DG. (1995) <a href="http://www.bmj.com/cgi/content/full/310/6977/446">Calculating correlation coefficients with repeated observations: Part 1, correlation within subjects.</a> <b>310</b>, 446.</p>

<p><em>Notes: I am replacing their terms for my notes:</em></p>
<ul>
  <li><em>X = Paco2</em></li>
  <li><em>Y = pHi</em></li>
</ul>

<p>In this note they show an example table using 8 subjects with <em>4-8 observations</em> for X and Y (<strong>table I</strong>):</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Subject</th>
      <th style="text-align: center">Y</th>
      <th style="text-align: center">X</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">1</td>
      <td style="text-align: center">6.68</td>
      <td style="text-align: center">3.97</td>
    </tr>
    <tr>
      <td style="text-align: left">1</td>
      <td style="text-align: center">6.53</td>
      <td style="text-align: center">4.12</td>
    </tr>
    <tr>
      <td style="text-align: left">…</td>
      <td style="text-align: center">…</td>
      <td style="text-align: center">…</td>
    </tr>
  </tbody>
</table>

<ul>
  <li>If subject’s average Y is related to the subject’s average X
    <ul>
      <li>We can use the correlation between the subject means, which they shall describe in a subsequent note.</li>
    </ul>
  </li>
  <li>If an increase in Y within the individual was associated with an increase in X
    <ul>
      <li>We want to remove the differences between subjects and look only at changes within.</li>
    </ul>
  </li>
</ul>

<p>To look at variation within the subject we can use multiple regression.</p>

<ul>
  <li>Make one variable, X or Y, the outcome variable and the other variable and the subject the predictor variables.</li>
  <li>
    <p>The subject is treated as a categorical factor using dummy variables and so has seven degrees of freedom.</p>
  </li>
  <li>Using an analysis of variance table for the regression (table II) shows how the variability in Y can be partitioned into components due to different sources.
    <ul>
      <li>Also known as analysis of covariance</li>
      <li>Equivalent to fitting parallel lines through each subject’s data (<strong>Figure 1.</strong>)</li>
    </ul>
  </li>
</ul>

<div class="table-wrapper">

  <table>
    <thead>
      <tr>
        <th style="text-align: left">Source of variation</th>
        <th style="text-align: right">Degrees of freedom</th>
        <th style="text-align: right">Sum of squares</th>
        <th style="text-align: right">Mean square</th>
        <th style="text-align: right">Variance ratio (F)</th>
        <th style="text-align: right">Probability</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td style="text-align: left">Subjects</td>
        <td style="text-align: right">7</td>
        <td style="text-align: right">2.9661</td>
        <td style="text-align: right">0.4237</td>
        <td style="text-align: right">48.3</td>
        <td style="text-align: right">\(&lt;\)0.0001</td>
      </tr>
      <tr>
        <td style="text-align: left">X</td>
        <td style="text-align: right">1</td>
        <td style="text-align: right">0.1153</td>
        <td style="text-align: right">0.1153</td>
        <td style="text-align: right">13.1</td>
        <td style="text-align: right">0.0008</td>
      </tr>
      <tr>
        <td style="text-align: left">Residual</td>
        <td style="text-align: right">38</td>
        <td style="text-align: right">0.3337</td>
        <td style="text-align: right">0.0088</td>
        <td style="text-align: right"> </td>
        <td style="text-align: right"> </td>
      </tr>
      <tr>
        <td style="text-align: left">Total</td>
        <td style="text-align: right">46</td>
        <td style="text-align: right">3.3139</td>
        <td style="text-align: right">0.0720</td>
        <td style="text-align: right"> </td>
        <td style="text-align: right"> </td>
      </tr>
    </tbody>
  </table>

</div>

<p>Table II. Analysis of variance for the data in table I (as shown in Altman &amp; Bland). At the end of this page, this table is reproduced based on the original data and new R code, as shown. (Note that there is a slight varition between the published version and my replicated version of table II and Figure 1 below; probably due to a minor data entry error by the publisher or authors).</p>

<ul>
  <li>The residual sum of squares in <strong>table II</strong> represents the variation about regression lines.</li>
  <li>This removes the variation due to subjects (and any other nuisance variables which might be present) and express the variation in Y due to X as a proportion of what’s left:
    <ul>
      <li>(Sum of squares for X)/(Sum of squares for X + residual sum of squares).</li>
    </ul>
  </li>
  <li>The magnitude of the correlation coefficient within subjects is the square root of this proportion.
    <ul>
      <li>For <strong>table II</strong> this is: \(\sqrt{ \frac{0.1153}{0.1153+0.3337} } = 0.51\)</li>
      <li>The sign of the correlation coefficient is given by the sign of the regression coefficient for X.</li>
    </ul>
  </li>
  <li>Regression slope is -0.108</li>
  <li>So the correlation coefficient within subjects is -0.51.</li>
  <li>The P value is found either from:
    <ul>
      <li>F test in the associated analysis of variance table,</li>
      <li>t test for the regression slope.</li>
      <li>It doesn’t matter which variable we regress on which;</li>
      <li>we get the same correlation coefficient and P value either way.</li>
    </ul>
  </li>
</ul>

<p>Incorrectly calculating the correlation coefficient 
by ignoring the fact that we have 47 observations on only 8 subjects, would produce -0.07, P=0.7.</p>

<p><img src="/images/altman_bland_repeated_observations.png" width="100%">
<strong>Figure 1.</strong> Recreation of “(Y) pH against (X) PaCO2 for eight subjects, with parallel lines fitted for each subject” as used in 
<a class="citation" href="#bland1995statistics">(Bland &amp; Altman, 1995)</a>.
Interestingly, replotting this data shows that their figure was not fully accurate (forgivable before the days of Rstudio in 1995, and not important for this example).</p>

<h2 id="correlation-within-subjects-part-2">Correlation within subjects, part 2</h2>

<p>The second part shows how to find the correlation between the subject means 
<a class="citation" href="#bland1995calculating">(Bland &amp; Altman, 1995)</a>,
number 12 on the list <a href="https://github.com/DylanLawless/notes/blob/main/202106291417-lit-altman_bland.md"> lit-altman_bland.md </a>:
12. Bland JM, Altman DG. (1995) <a href="http://www.bmj.com/cgi/content/full/310/6980/633">Calculating correlation coefficients with repeated observations: Part 2, correlation between subjects.</a> <b>310</b>, 633.</p>

<p>In this note they show the example table using the same 8 subjects with <em>one mean observation</em> for X and Y:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">Subject</th>
      <th style="text-align: center">Y</th>
      <th style="text-align: center">X</th>
      <th style="text-align: center">Number</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">1</td>
      <td style="text-align: center">6.49</td>
      <td style="text-align: center">4.04</td>
      <td style="text-align: center">4</td>
    </tr>
    <tr>
      <td style="text-align: center">2</td>
      <td style="text-align: center">7.05</td>
      <td style="text-align: center">5.37</td>
      <td style="text-align: center">4</td>
    </tr>
    <tr>
      <td style="text-align: center">3</td>
      <td style="text-align: center">7.36</td>
      <td style="text-align: center">4.83</td>
      <td style="text-align: center">9</td>
    </tr>
    <tr>
      <td style="text-align: center">4</td>
      <td style="text-align: center">7.33</td>
      <td style="text-align: center">5.31</td>
      <td style="text-align: center">5</td>
    </tr>
    <tr>
      <td style="text-align: center">5</td>
      <td style="text-align: center">7.31</td>
      <td style="text-align: center">4.40</td>
      <td style="text-align: center">8</td>
    </tr>
    <tr>
      <td style="text-align: center">6</td>
      <td style="text-align: center">7.32</td>
      <td style="text-align: center">4.92</td>
      <td style="text-align: center">6</td>
    </tr>
    <tr>
      <td style="text-align: center">7</td>
      <td style="text-align: center">6.91</td>
      <td style="text-align: center">6.60</td>
      <td style="text-align: center">3</td>
    </tr>
    <tr>
      <td style="text-align: center">8</td>
      <td style="text-align: center">7.12</td>
      <td style="text-align: center">4.78</td>
      <td style="text-align: center">8</td>
    </tr>
  </tbody>
</table>

<ul>
  <li>If subject’s average Y is related to the subject’s average X
    <ul>
      <li>We can use the correlation between the subject means.</li>
    </ul>
  </li>
</ul>

<p>They calculate the usual correlation coefficient for the mean Y and mean X; r=0.09, P=0.8.
Does not take into account the different numbers of measurements on each subject.</p>

<ul>
  <li>Does this matter?:
    <ul>
      <li>Depends on how different the numbers of observations are</li>
      <li>whether the measurements within subjects vary much compared with the means between subjects</li>
    </ul>
  </li>
</ul>

<p>We can calculate a weighted correlation coefficient using the number of observations as weights. 
Many computer programs will calculate this, but it is not difficult to do by hand.</p>

<ul>
  <li>They denote the mean Y and X for subject i by \(\bar{x}_i\) and \(\bar{y}_i\),</li>
  <li>the number of observations for subject i by \(m_i\),</li>
  <li>and the number of subjects by \(n\).</li>
  <li>The weighted mean of the \(\bar{x}_i\) is 
\(\frac{ \sum{ m_i \bar{x}_i } }{ \sum{ m_i } }\)
<!-- (summation)mixi/(summation)mi. -->
</li>
</ul>

<p>In the usual case, where there is one observation per subject, the \(m_i\) 
are all one and this formula gives the usual mean 
\(\frac{ \sum{\bar{x}_i} }{n}\).
<!-- (summation)xi/n. --></p>

<p>An easy way to calculate the weighted correlation coefficient is to replace each individual observation by its subject mean. 
Thus the table would yield 47 pairs of observations, 
the first four of which would each be pH=6.49 and Paco2=4.04, and so on.</p>

<p>If we use the usual formula for the correlation coefficient on the expanded data we will get the weighted correlation coefficient. 
However, we must be careful when it comes to the P value. 
We have only 8 observations (n in general), not 47. 
We should ignore any P value printed by our computer program, and use a statistical table instead.</p>

<p>The formula for a weighted correlation coefficient is:</p>

<div class="math-container">
$$
\frac{
\sum{m_i \bar{x}_i \bar{y}_i} 
-
\sum{m_i \bar{x}_i} \sum{m_i \bar{y}_i} 
\mathbin{/}
\sum{m_i}
}{
\sqrt{
 ( 
 \sum{m_i \bar{y}_i^2} 
 -
 (\sum{m_i \bar{y}_i})^2 
 \mathbin{/}
 \sum{m_i}
 )
 ( 
 \sum{m_i \bar{y}_i^2} 
 -
 (\sum{m_i \bar{y}_i})^2 
 \mathbin{/}
 \sum{m_i}
 )}
 }
 $$
</div>

<p>where all summations are from \(i=1\) to \(n\). 
When all the \(m_i\) are equal they cancel out, 
giving the usual formula for a correlation coefficient.</p>

<p>For the data in the table the weighted correlation coefficient is r=0.08, P=0.9. 
There is no evidence that subjects with a high Y also have a high X. 
However, as they have already shown in part 1, 
within the subject a rise in Y was associated with a fall in X.</p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## Code and raw data for Table I, Analysis of variance table II, and Figure 1</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="w"> </span><span class="p">(</span><span class="w">
  </span><span class="n">Subject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"2"</span><span class="p">,</span><span class="w"> </span><span class="s2">"2"</span><span class="p">,</span><span class="w"> </span><span class="s2">"2"</span><span class="p">,</span><span class="w"> </span><span class="s2">"2"</span><span class="p">,</span><span class="w"> </span><span class="s2">"3"</span><span class="p">,</span><span class="w"> </span><span class="s2">"3"</span><span class="p">,</span><span class="w"> </span><span class="s2">"3"</span><span class="p">,</span><span class="w"> </span><span class="s2">"3"</span><span class="p">,</span><span class="w"> </span><span class="s2">"3"</span><span class="p">,</span><span class="w"> </span><span class="s2">"3"</span><span class="p">,</span><span class="w"> </span><span class="s2">"3"</span><span class="p">,</span><span class="w"> </span><span class="s2">"3"</span><span class="p">,</span><span class="w"> </span><span class="s2">"3"</span><span class="p">,</span><span class="w"> </span><span class="s2">"4"</span><span class="p">,</span><span class="w"> </span><span class="s2">"4"</span><span class="p">,</span><span class="w"> </span><span class="s2">"4"</span><span class="p">,</span><span class="w"> </span><span class="s2">"4"</span><span class="p">,</span><span class="w"> </span><span class="s2">"4"</span><span class="p">,</span><span class="w"> </span><span class="s2">"5"</span><span class="p">,</span><span class="w"> </span><span class="s2">"5"</span><span class="p">,</span><span class="w"> </span><span class="s2">"5"</span><span class="p">,</span><span class="w"> </span><span class="s2">"5"</span><span class="p">,</span><span class="w"> </span><span class="s2">"5"</span><span class="p">,</span><span class="w"> </span><span class="s2">"5"</span><span class="p">,</span><span class="w"> </span><span class="s2">"5"</span><span class="p">,</span><span class="w"> </span><span class="s2">"5"</span><span class="p">,</span><span class="w"> </span><span class="s2">"6"</span><span class="p">,</span><span class="w"> </span><span class="s2">"6"</span><span class="p">,</span><span class="w"> </span><span class="s2">"6"</span><span class="p">,</span><span class="w"> </span><span class="s2">"6"</span><span class="p">,</span><span class="w"> </span><span class="s2">"6"</span><span class="p">,</span><span class="w"> </span><span class="s2">"6"</span><span class="p">,</span><span class="w"> </span><span class="s2">"7"</span><span class="p">,</span><span class="w"> </span><span class="s2">"7"</span><span class="p">,</span><span class="w"> </span><span class="s2">"7"</span><span class="p">,</span><span class="w"> </span><span class="s2">"8"</span><span class="p">,</span><span class="w"> </span><span class="s2">"8"</span><span class="p">,</span><span class="w"> </span><span class="s2">"8"</span><span class="p">,</span><span class="w"> </span><span class="s2">"8"</span><span class="p">,</span><span class="w"> </span><span class="s2">"8"</span><span class="p">,</span><span class="w"> </span><span class="s2">"8"</span><span class="p">,</span><span class="w"> </span><span class="s2">"8"</span><span class="p">,</span><span class="w"> </span><span class="s2">"8"</span><span class="p">),</span><span class="w">

  </span><span class="n">Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">6.68</span><span class="p">,</span><span class="w"> </span><span class="m">6.53</span><span class="p">,</span><span class="w"> </span><span class="m">6.43</span><span class="p">,</span><span class="w"> </span><span class="m">6.33</span><span class="p">,</span><span class="w"> </span><span class="m">6.85</span><span class="p">,</span><span class="w"> </span><span class="m">7.06</span><span class="p">,</span><span class="w"> </span><span class="m">7.13</span><span class="p">,</span><span class="w"> </span><span class="m">7.17</span><span class="p">,</span><span class="w"> </span><span class="m">7.4</span><span class="p">,</span><span class="w"> </span><span class="m">7.42</span><span class="p">,</span><span class="w"> </span><span class="m">7.41</span><span class="p">,</span><span class="w"> </span><span class="m">7.37</span><span class="p">,</span><span class="w"> </span><span class="m">7.34</span><span class="p">,</span><span class="w"> </span><span class="m">7.35</span><span class="p">,</span><span class="w"> </span><span class="m">7.28</span><span class="p">,</span><span class="w"> </span><span class="m">7.3</span><span class="p">,</span><span class="w"> </span><span class="m">7.34</span><span class="p">,</span><span class="w"> </span><span class="m">7.36</span><span class="p">,</span><span class="w"> </span><span class="m">7.33</span><span class="p">,</span><span class="w"> </span><span class="m">7.29</span><span class="p">,</span><span class="w"> </span><span class="m">7.3</span><span class="p">,</span><span class="w"> </span><span class="m">7.35</span><span class="p">,</span><span class="w"> </span><span class="m">7.35</span><span class="p">,</span><span class="w"> </span><span class="m">7.3</span><span class="p">,</span><span class="w"> </span><span class="m">7.3</span><span class="p">,</span><span class="w"> </span><span class="m">7.37</span><span class="p">,</span><span class="w"> </span><span class="m">7.27</span><span class="p">,</span><span class="w"> </span><span class="m">7.28</span><span class="p">,</span><span class="w"> </span><span class="m">7.32</span><span class="p">,</span><span class="w"> </span><span class="m">7.32</span><span class="p">,</span><span class="w"> </span><span class="m">7.38</span><span class="p">,</span><span class="w"> </span><span class="m">7.3</span><span class="p">,</span><span class="w"> </span><span class="m">7.29</span><span class="p">,</span><span class="w"> </span><span class="m">7.33</span><span class="p">,</span><span class="w"> </span><span class="m">7.31</span><span class="p">,</span><span class="w"> </span><span class="m">7.33</span><span class="p">,</span><span class="w"> </span><span class="m">6.86</span><span class="p">,</span><span class="w"> </span><span class="m">6.94</span><span class="p">,</span><span class="w"> </span><span class="m">6.92</span><span class="p">,</span><span class="w"> </span><span class="m">7.19</span><span class="p">,</span><span class="w"> </span><span class="m">7.29</span><span class="p">,</span><span class="w"> </span><span class="m">7.21</span><span class="p">,</span><span class="w"> </span><span class="m">7.25</span><span class="p">,</span><span class="w"> </span><span class="m">7.2</span><span class="p">,</span><span class="w"> </span><span class="m">7.19</span><span class="p">,</span><span class="w"> </span><span class="m">6.77</span><span class="p">,</span><span class="w"> </span><span class="m">6.82</span><span class="p">),</span><span class="w">

  </span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">3.97</span><span class="p">,</span><span class="w"> </span><span class="m">4.12</span><span class="p">,</span><span class="w"> </span><span class="m">4.09</span><span class="p">,</span><span class="w"> </span><span class="m">3.97</span><span class="p">,</span><span class="w"> </span><span class="m">5.27</span><span class="p">,</span><span class="w"> </span><span class="m">5.37</span><span class="p">,</span><span class="w"> </span><span class="m">5.41</span><span class="p">,</span><span class="w"> </span><span class="m">5.44</span><span class="p">,</span><span class="w"> </span><span class="m">5.67</span><span class="p">,</span><span class="w"> </span><span class="m">3.64</span><span class="p">,</span><span class="w"> </span><span class="m">4.32</span><span class="p">,</span><span class="w"> </span><span class="m">4.73</span><span class="p">,</span><span class="w"> </span><span class="m">4.96</span><span class="p">,</span><span class="w"> </span><span class="m">5.04</span><span class="p">,</span><span class="w"> </span><span class="m">5.22</span><span class="p">,</span><span class="w"> </span><span class="m">4.82</span><span class="p">,</span><span class="w"> </span><span class="m">5.07</span><span class="p">,</span><span class="w"> </span><span class="m">5.67</span><span class="p">,</span><span class="w"> </span><span class="m">5.1</span><span class="p">,</span><span class="w"> </span><span class="m">5.53</span><span class="p">,</span><span class="w"> </span><span class="m">4.75</span><span class="p">,</span><span class="w"> </span><span class="m">5.51</span><span class="p">,</span><span class="w"> </span><span class="m">4.28</span><span class="p">,</span><span class="w"> </span><span class="m">4.44</span><span class="p">,</span><span class="w"> </span><span class="m">4.32</span><span class="p">,</span><span class="w"> </span><span class="m">3.23</span><span class="p">,</span><span class="w"> </span><span class="m">4.46</span><span class="p">,</span><span class="w"> </span><span class="m">4.72</span><span class="p">,</span><span class="w"> </span><span class="m">4.75</span><span class="p">,</span><span class="w"> </span><span class="m">4.99</span><span class="p">,</span><span class="w"> </span><span class="m">4.78</span><span class="p">,</span><span class="w"> </span><span class="m">4.73</span><span class="p">,</span><span class="w"> </span><span class="m">5.12</span><span class="p">,</span><span class="w"> </span><span class="m">4.93</span><span class="p">,</span><span class="w"> </span><span class="m">5.03</span><span class="p">,</span><span class="w"> </span><span class="m">4.93</span><span class="p">,</span><span class="w"> </span><span class="m">6.85</span><span class="p">,</span><span class="w"> </span><span class="m">6.44</span><span class="p">,</span><span class="w"> </span><span class="m">6.52</span><span class="p">,</span><span class="w"> </span><span class="m">5.28</span><span class="p">,</span><span class="w"> </span><span class="m">4.56</span><span class="p">,</span><span class="w"> </span><span class="m">4.34</span><span class="p">,</span><span class="w"> </span><span class="m">4.32</span><span class="p">,</span><span class="w"> </span><span class="m">4.41</span><span class="p">,</span><span class="w"> </span><span class="m">3.69</span><span class="p">,</span><span class="w"> </span><span class="m">6.09</span><span class="p">,</span><span class="w"> </span><span class="m">5.58</span><span class="p">)</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="c1"># Run the Analysis of Variance with mutiple variable</span><span class="w">
</span><span class="n">name</span><span class="o">=</span><span class="n">aov</span><span class="p">(</span><span class="n">Y</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Subject</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">)</span><span class="w"> </span><span class="c1">#runs the ANOVA test</span><span class="w">
</span><span class="n">ls</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="c1">#lists the items stored by the test.</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="c1">#give the basic ANOVA output.</span><span class="w">

</span><span class="c1"># Output the column totals to match Altman &amp; Bland table</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">unlist</span><span class="p">(</span><span class="w"> </span><span class="n">summary</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="p">))</span><span class="w">

</span><span class="nf">sum</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,])</span><span class="w"> </span><span class="c1"># Total Degrees of freedom</span><span class="w">
</span><span class="nf">sum</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="m">4</span><span class="o">:</span><span class="m">6</span><span class="p">,])</span><span class="w"> </span><span class="c1"># Total Sum Sq</span><span class="w">
</span><span class="nf">sum</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="m">7</span><span class="o">:</span><span class="m">9</span><span class="p">,])</span><span class="w"> </span><span class="c1"># Total Mean Sq</span><span class="w">

</span></code></pre></div></div>

<div class="table-wrapper">

  <table>
    <thead>
      <tr>
        <th> </th>
        <th>Degrees of freedom</th>
        <th>Sum of squares</th>
        <th>Mean Square</th>
        <th>Variance ratio (F)</th>
        <th>Probability</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>df$Subject</td>
        <td>7</td>
        <td>2.8648</td>
        <td>0.4093</td>
        <td>46.60</td>
        <td>&lt; 2e-16</td>
      </tr>
      <tr>
        <td>df$X</td>
        <td>1</td>
        <td>0.1153</td>
        <td>0.1153</td>
        <td>13.13</td>
        <td>0.000847</td>
      </tr>
      <tr>
        <td>Residuals</td>
        <td>38</td>
        <td>0.3337</td>
        <td>0.0088</td>
        <td> </td>
        <td> </td>
      </tr>
    </tbody>
  </table>

</div>

<p>Replicated version of Table II. Analysis of variance for the data in table I.
Default R output headings modified:
Degrees of freedom (Df),
Sum of squares (Sum Sq),
Mean square (Mean Sq),
Variance ratio F (F value),
Probability (Pr(&gt;F)).
(Repeated note: there is a slight varition between the published version and my replicated version of table II and Figure 1; probably due to a minor data entry error by the publisher or authors).</p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># code used to produce Figure 1. </span><span class="w">

</span><span class="n">require</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="o">=</span><span class="n">Subject</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Subject</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Subject</span><span class="p">),</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"lm"</span><span class="p">,</span><span class="w"> </span><span class="n">formula</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">se</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">

</span><span class="c1"># The dataset is cited by Bland &amp; Altman 1995 as: "Boyd O, Mackay CJ, Lamb G, Bland JM, Grounds RM, Bennett ED.Comparison of clinical information gained from routine blood-gas analysis and from gastric tonometry for intramural pH.Lancet1993;341:142–6."</span><span class="w">

</span></code></pre></div></div>

<h2 id="references">References</h2>

<ol class="bibliography">
<li><span id="bland1994correlation">Bland, J. M., &amp; Altman, D. G. (1994). Correlation, regression, and repeated data. <i>BMJ: British Medical Journal</i>, <i>308</i>(6933), 896.</span></li>
<li><span id="bland1995statistics">Bland, J. M., &amp; Altman, D. G. (1995). Statistics notes: Calculating correlation coefficients with repeated observations: Part 1—correlation within subjects. <i>Bmj</i>, <i>310</i>(6977), 446.</span></li>
<li><span id="bland1995calculating">Bland, J. M., &amp; Altman, D. G. (1995). Calculating correlation coefficients with repeated observations: Part 2—Correlation between subjects. <i>Bmj</i>, <i>310</i>(6980), 633.</span></li>
</ol>

<p><strong>Footnote</strong>
<b id="f1">1</b> This article is almost identical to the original version in acknowledgment to Altman and Bland. It is adapted here as part of a set of curated, consistent, and minimal examples of statistics required for human genomic analysis.
<a href="#a1">↩</a></p>

</div>

<!--

<div id="related">
  <h2>Related Topics</h2>
  <ul class="topics">
    
  </ul>
</div>

-->

















</div>
<!-- # MAIN END ---------------------------------------------------------- -->

<!-- FOOT START -------------------------------------------------------- -->
<div class="sitewidthnav">
	<div class="footer">
		<div class="foot-container">
				<a href="/" class="logo-foot">
				<img style="margin-bottom:-16px" src="/images/logos/logo4.2_150ppi.png" alt="Logo image" width="25" height="38.5"></a>
					<div class="right-root">
						<p><a href="https://github.com/DylanLawless/DylanLawless.github.io/tree/source">Maintained</a> by Dylan Lawless. Scientist at <a href="https://people.epfl.ch/dylan.lawless">EPFL</a>.
						<a href="/resume">Resume</a>
						and <a href="https://scholar.google.com/citations?user=RPBxP1wAAAAJ&hl=en&oi=ao">Google scholar</a>.
						<a href="https://lawlessgenomics.com/feed.xml">RSS feed</a>
						</p>
					</div>
		</div>
	</div>
</div>
<!-- FOOT END ---------------------------------------------------------- -->

</div>
<!-- SITE END ----------------------------------------------------------- -->


<!-- Banner on top right corner linking to github
<a href="https://github.com/mojombo"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub" /></a>
-->

<!-- ClickTale Bottom part -->
<div id="ClickTaleDiv" style="display: none;"></div>
<script type="text/javascript">
if(document.location.protocol!='https:')
  document.write(unescape("%3Cscript%20src='https://s.clicktale.net/WRb.js'%20type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
if(typeof ClickTale=='function') ClickTale(206,0.3,"www03");
</script>
<!-- ClickTale end of Bottom part -->

<!-- Google Analytics -->
<!--
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "https://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-6016902-1");
pageTracker._trackPageview();
</script>
-->
<!-- Google Analytics end -->

</body>
</html>
