I"g<h1 id="genome-wide-assocciation-study">Genome wide assocciation study</h1>

<ul id="markdown-toc">
  <li><a href="#genome-wide-assocciation-study" id="markdown-toc-genome-wide-assocciation-study">Genome wide assocciation study</a></li>
  <li><a href="#abbreviations" id="markdown-toc-abbreviations">Abbreviations</a></li>
  <li><a href="#sample-collection-and-genotyping" id="markdown-toc-sample-collection-and-genotyping">Sample collection and genotyping</a></li>
  <li><a href="#pre-imputation" id="markdown-toc-pre-imputation">Pre-imputation</a></li>
  <li><a href="#imputation" id="markdown-toc-imputation">Imputation</a></li>
  <li><a href="#information-score" id="markdown-toc-information-score">Information score</a></li>
  <li><a href="#get-snptest-summary-with-impute-information-score" id="markdown-toc-get-snptest-summary-with-impute-information-score">Get snptest summary with impute information score¬</a></li>
  <li><a href="#imputation-to-plink-format" id="markdown-toc-imputation-to-plink-format">Imputation to Plink format</a></li>
  <li><a href="#conclusion" id="markdown-toc-conclusion">Conclusion</a></li>
  <li><a href="#command-line-example-code" id="markdown-toc-command-line-example-code">Command line example code</a></li>
</ul>

<h1 id="abbreviations">Abbreviations</h1>
<p>BWA (Burrows-Wheeler transformation aligner), 
GrCh38 (Genome Reference Consortium Human Build 38), 
VCF (variant call format).</p>

<h1 id="sample-collection-and-genotyping">Sample collection and genotyping</h1>

<h1 id="pre-imputation">Pre-imputation</h1>
<p>Before imputation with study genotypes, filter the data to remove low-quality variants and samples. 
Standard GWAS quality control filters are usually sufficient to prepare a dataset for imputation. 
It may also help to add an imputation-based QC step to the filtering process.</p>

<p><a href="https://academic.oup.com/bfg/article/15/4/298/2412127">Coleman et al. 2016</a></p>

<h1 id="imputation">Imputation</h1>
<p><strong>File formats</strong>
The file format required depends on the method chosen.
VCF file is the most common input type (e.g. Sanger imputation).
Plink format files (bim, bed, fam, or pgen, psam ) can be converted to VCF using Plink.
VCF may be converted to a gen file (e.g. Impute2).</p>

<p><strong>Example</strong>
Plink binary files to VCF.
https://www.cog-genomics.org/plink/1.9</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>plink <span class="nt">--bfile</span> binary_fileset <span class="nt">--recode</span> vcf <span class="nt">--out</span> new_vcf
</code></pre></div></div>

<p><strong>Imputation services</strong>
Online: Sanger Imputation server
<a href="https://www.sanger.ac.uk/tool/sanger-imputation-service/">sanger.ac.uk</a>
is a genotype imputation and phasing service provided by the Wellcome Sanger Institute. 
You can upload GWAS data in VCF or 23andMe format and receive imputed and phased genomes back. 
Optional pre-phasing is with EAGLE2 or SHAPEIT2 and imputation is with PBWT into a choice of reference panels including 1000 Genomes Phase 3, UK10K, and the Haplotype Reference Consortium.</p>

<p>Online: Michigan Imputation Server
<a href="https://imputationserver.sph.umich.edu/index.html#!">imputationserver.sph.umich.edu</a>
based on 
<a href="https://pubmed.ncbi.nlm.nih.gov/27571263/">Foreret al. 2016</a>
.
Open source, offers methods to build your own server.
Reference panels: 
HapMap Release 2.
1000 Genomes,
Phase 1 and 3,
CAAPA,
African American,
Haplotype Reference Consortium.</p>

<p>Local software: IMPUTE version 2 (also known as IMPUTE2) is a genotype imputation and haplotype phasing program based on ideas from 
<a href="https://journals.plos.org/plosgenetics/article?id=10.1371/journal.pgen.1000529">Howie et al. 2009</a>
but has features from additional publications</p>

<p>From Impute2, the process is summed up as “the most common scenario in which imputation is used: 
unobserved genotypes (red question marks) in a set of study individuals are imputed (or predicted) using a set of reference haplotypes and genotypes from a SNP chip.</p>

<h1 id="information-score">Information score</h1>
<p>Since the imputation non-genotyped variants is based on a reference panel that
may not fully represent the ancestry of a study cohort, a quality score may be 
desired.</p>

<p>One tool is SNPTEST
<a href="https://mathgen.stats.ox.ac.uk/genetics_software/snptest/snptest.html#info_measures">mathgen.stats.ox.ac.uk</a>
From mathgen.stats.ox.ac.uk, the IMPUTE info measure reflects the information in imputed genotypes relative to the information if only the allele frequency were known.</p>

\[info = 1 - mean( variance in imputed genotype / variance if only allele frequency were known )\]

<p>The numerator of this expression is computed over the imputed genotype distribution for each sample. The denominator is computed using the estimated allele frequency</p>

\[\theta = \sum_{i}(P(g_{i}=2)+2P(g_{i}=2)) / 2\sum_{i,g}P(g_{i}=g)\]

<p>and the assumption of Hardy-Weinberg equilibrium.
The info measure takes the value 1 if all genotypes are completely certain, 
and the value 0 if the genotype probabilities for each sample are completely uncertain in Hardy-Weinberg proportions 
(i.e. they equal
\((1-\theta)2, 2\theta(1-\theta), \theta2).\)
It is also possible for info to drop below zero.</p>

<p>Info is usually computed as if assuming all samples are diploid and that the genotype probabilities for each sample sum to one. This is what IMPUTE computes, and also what SNPTEST computes when you use a method other than newml.</p>

<h1 id="get-snptest-summary-with-impute-information-score">Get snptest summary with impute information score¬</h1>
<p>for i in {1..22}¬
do¬
›   for file in S<em>chr$i.</em>impute2¬
›   do¬
›   ›   /work/gr-fe/lawless/tool/snptest_v2.5.4-beta3_linux_x86_64_dynamic/snptest_v2.5.4-beta3 \¬
›   ›   -data $file \¬
›   ›   $raw/SPSS_samples \¬
›   ›   -filetype gen \¬
›   ›   -summary_stats_only \¬
›   ›   -o $file_snptest¬
›   done &amp;¬
done¬
wait¬</p>

<h1 id="imputation-to-plink-format">Imputation to Plink format</h1>
<p>File formats output</p>

<p>#</p>
<h1 id="conclusion">Conclusion</h1>

<h1 id="command-line-example-code">Command line example code</h1>
<p><strong>Whole exome analysis</strong></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

</code></pre></div></div>
:ET