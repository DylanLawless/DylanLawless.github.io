---
layout: topic
title: Zero-inflated negative binomial regression
created: 2021-04-26
tags: statistics
status: unfinished
subject: statistics
---
{{ page.title }}
================
* TOC
{:toc}

## Zero-inflated negative binomial regression

Zero-inflated negative binomial regression (zinbr) is for modeling count variables with excessive zeros and it is usually for overdispersed count outcome variables. 

The excess zeros are generated by a process that can be explained separately from the count values. The excess zeros can be modeled independently.

We have data on 250 groups that went to a park. 
Fish count - how many fish a group caught
Child count - how many children were in the group, 
Person count  - many people were in the group, 
Camper binary - whether or not they brought a camper to the park.

In addition to predicting the number of fish caught, 
there is interest in predicting the existence of excess zeros, i.e., the probability that a group caught zero fish. 

``` R
zinb <- read.csv("https://stats.idre.ucla.edu/stat/data/fish.csv")
zinb <- within(zinb, {
  nofish <- factor(nofish)
  livebait <- factor(livebait)
  camper <- factor(camper)
})

summary(zinb)
```


A zero-inflated model assumes that zero outcome is due to two different processes. 

* a subject has gone fishing vs. 
* not gone fishing. 

If gone fishing = count process.
If not gone fishing = the only outcome possible is zero.
 

The two parts of the a zero-inflated model are 
1. Binary model
	- usually a logit model: models which of the two processes the zero outcome is associated with. 
2. Count model
	- in this case, a negative binomial model: models the count process. 

The expected count is expressed as a combination of the two processes. 


Taking the example of fishing again:


$
E(n_{\text{fish caught}} = k) = P(\text{not gone fishing}) * 0 + P(\text{gone fishing}) * E(y = k | \text{gone fishing})
$


### A negative binomial model. 
There are multiple parameterizations of the negative binomial model, 
we focus on NB2. 
The negative binomial probability density function is:

$
PDF(y; p, r) = \frac{(y_i + r – 1)!}{y_i!(r-1)!}p_{i}^{r}(1 – p_i)^{y_i}
$
where  (p) is the probability of (r) successes. 

From this we can derive the likelihood function, which is given by:
$
L(\mu; y, \alpha) = \prod_{i=1}^{n}exp\left(y_i ln\left(\frac{\alpha\mu_i}{1 +\alpha\mu_i}\right)-\frac{1}{\alpha}ln(1 + \alpha\mu_i) + ln\Gamma(y_i + \frac{1}{\alpha})-ln\Gamma(y_i + 1) – ln\Gamma(\frac{1}{\alpha})\right)
$

here we find the likelihood of the expected value, 
$$\mu$$ (mu)
 given the data and 
$$\alpha$$ (alpha)
which allows for dispersion. 
Typically, this would be expressed as a log likelihood, denoted by
$$\mathcal{L}$$
(script L)
([sidenote](https://stats.stackexchange.com/questions/284816/why-do-people-use-mathcall-thetax-for-likelihood-instead-of-px-theta)):

$
\mathcal{L}(\mu; y, \alpha) = \sum_{i=1}^{n}y_i ln\left(\frac{\alpha\mu_i}{1 + \alpha\mu_i}\right)-\frac{1}{\alpha}ln(1 + \alpha\mu_i) + ln\Gamma(y_i + \frac{1}{\alpha})-ln\Gamma(y_i + 1) – ln\Gamma(\frac{1}{\alpha})
$

which can be expressed in terms of our model by replacing
$$\mu_i$$
with 
$$exp(x_i'\beta)$$.

Turning to the zero-inflated negative binomial model, 
the expression of the likelihood function depends on whether the observed value is a zero or greater than zero. 
From the logistic model of 
$$y_i > 1$$ versus $$ y = 0$$:

$p = \frac{1}{1 + e^{-x_i'\beta}}$ 
and 
$1 - p = \frac{1}{1 + e^{x_i'\beta}}$ then

$
\mathcal{L} = \left\{ \begin{array}{ll} \sum_{i=1}^{n} \left[ ln(p_{i}) + (1 – p_i)\left(\frac{1}{1 + \alpha\mu_{i}}\right)^{\frac{1}{\alpha}} \right] &\mbox{if } y_{i} = 0 \\
\sum_{i=1}^{n} \left[ ln(p_{i}) + ln\Gamma\left(\frac{1}{\alpha} + y_i\right) – ln\Gamma(y_i + 1) – ln\Gamma\left(\frac{1}{\alpha}\right) + \left(\frac{1}{\alpha}\right)ln\left(\frac{1}{1 + \alpha\mu_{i}}\right) + y_iln\left(1 – \frac{1}{1 + \alpha\mu_{i}}\right) \right] &\mbox{if } y_{i} > 0 \end{array} \right. ] ]
$

Finally, note that R does not estimate 
$$\alpha$$
 but its inverse:
 $$\theta$$.

Now let's build up our model. 
We are going to use the variables 
* child and 
* camper 
to model the count in the part of negative binomial model and the 
* variable persons 
in the logit part of the model.
We use the pscl to run a zero-inflated negative binomial regression. We begin by estimating the model with the variables of interest.

``` R
m1 <- zeroinfl(count ~ child + camper | persons,
  data = zinb, dist = "negbin", EM = TRUE)
  summary(m1)
```





## Analysis methods you might consider
Some other methods that you might use.

OLS Regression – You could try to analyze these data using OLS regression. However, count data are highly non-normal and are not well estimated by OLS regression.
Zero-inflated Poisson Regression – Zero-inflated Poisson regression does better when the data is not overdispersed, i.e. when variance is not much larger than the mean.
Ordinary Count Models – Poisson or negative binomial models might be more appropriate if there are not excess zeros.



